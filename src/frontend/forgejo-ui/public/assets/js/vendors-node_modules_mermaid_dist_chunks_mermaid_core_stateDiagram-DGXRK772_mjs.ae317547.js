"use strict";(self.webpackChunkforgejo=self.webpackChunkforgejo||[]).push([["vendors-node_modules_mermaid_dist_chunks_mermaid_core_stateDiagram-DGXRK772_mjs"],{"./node_modules/mermaid/dist/chunks/mermaid.core/stateDiagram-DGXRK772.mjs":function(dt,L,D){D.d(L,{diagram:function(){return nt}});var M=D("./node_modules/mermaid/dist/chunks/mermaid.core/chunk-AEK57VVT.mjs"),st=D("./node_modules/mermaid/dist/chunks/mermaid.core/chunk-RZ5BOZE2.mjs"),rt=D("./node_modules/mermaid/dist/chunks/mermaid.core/chunk-TYCBKAJE.mjs"),ot=D("./node_modules/mermaid/dist/chunks/mermaid.core/chunk-IIMUDSI4.mjs"),ct=D("./node_modules/mermaid/dist/chunks/mermaid.core/chunk-VV3M67IP.mjs"),ht=D("./node_modules/mermaid/dist/chunks/mermaid.core/chunk-HRU6DDCH.mjs"),lt=D("./node_modules/mermaid/dist/chunks/mermaid.core/chunk-K557N5IZ.mjs"),gt=D("./node_modules/mermaid/dist/chunks/mermaid.core/chunk-H2D2JQ3I.mjs"),pt=D("./node_modules/mermaid/dist/chunks/mermaid.core/chunk-C3MQ5ANM.mjs"),j=D("./node_modules/mermaid/dist/chunks/mermaid.core/chunk-O4NI6UNU.mjs"),t=D("./node_modules/mermaid/dist/chunks/mermaid.core/chunk-YTJNT7DU.mjs"),K=D("./node_modules/d3/src/index.js"),U=D("./node_modules/dagre-d3-es/src/dagre/index.js"),A=D("./node_modules/dagre-d3-es/src/graphlib/index.js"),R={},C=(0,t.K2)((e,i)=>{R[e]=i},"set"),I=(0,t.K2)(e=>R[e],"get"),P=(0,t.K2)(()=>Object.keys(R),"keys"),H=(0,t.K2)(()=>P().length,"size"),W={get:I,set:C,keys:P,size:H},z=(0,t.K2)(e=>e.append("circle").attr("class","start-state").attr("r",(0,t.D7)().state.sizeUnit).attr("cx",(0,t.D7)().state.padding+(0,t.D7)().state.sizeUnit).attr("cy",(0,t.D7)().state.padding+(0,t.D7)().state.sizeUnit),"drawStartState"),G=(0,t.K2)(e=>e.append("line").style("stroke","grey").style("stroke-dasharray","3").attr("x1",(0,t.D7)().state.textHeight).attr("class","divider").attr("x2",(0,t.D7)().state.textHeight*2).attr("y1",0).attr("y2",0),"drawDivider"),J=(0,t.K2)((e,i)=>{const r=e.append("text").attr("x",2*(0,t.D7)().state.padding).attr("y",(0,t.D7)().state.textHeight+2*(0,t.D7)().state.padding).attr("font-size",(0,t.D7)().state.fontSize).attr("class","state-title").text(i.id),o=r.node().getBBox();return e.insert("rect",":first-child").attr("x",(0,t.D7)().state.padding).attr("y",(0,t.D7)().state.padding).attr("width",o.width+2*(0,t.D7)().state.padding).attr("height",o.height+2*(0,t.D7)().state.padding).attr("rx",(0,t.D7)().state.radius),r},"drawSimpleState"),Y=(0,t.K2)((e,i)=>{const r=(0,t.K2)(function(h,f,E){const w=h.append("tspan").attr("x",2*(0,t.D7)().state.padding).text(f);E||w.attr("dy",(0,t.D7)().state.textHeight)},"addTspan"),d=e.append("text").attr("x",2*(0,t.D7)().state.padding).attr("y",(0,t.D7)().state.textHeight+1.3*(0,t.D7)().state.padding).attr("font-size",(0,t.D7)().state.fontSize).attr("class","state-title").text(i.descriptions[0]).node().getBBox(),g=d.height,u=e.append("text").attr("x",(0,t.D7)().state.padding).attr("y",g+(0,t.D7)().state.padding*.4+(0,t.D7)().state.dividerMargin+(0,t.D7)().state.textHeight).attr("class","state-description");let a=!0,s=!0;i.descriptions.forEach(function(h){a||(r(u,h,s),s=!1),a=!1});const x=e.append("line").attr("x1",(0,t.D7)().state.padding).attr("y1",(0,t.D7)().state.padding+g+(0,t.D7)().state.dividerMargin/2).attr("y2",(0,t.D7)().state.padding+g+(0,t.D7)().state.dividerMargin/2).attr("class","descr-divider"),p=u.node().getBBox(),c=Math.max(p.width,d.width);return x.attr("x2",c+3*(0,t.D7)().state.padding),e.insert("rect",":first-child").attr("x",(0,t.D7)().state.padding).attr("y",(0,t.D7)().state.padding).attr("width",c+2*(0,t.D7)().state.padding).attr("height",p.height+g+2*(0,t.D7)().state.padding).attr("rx",(0,t.D7)().state.radius),e},"drawDescrState"),Z=(0,t.K2)((e,i,r)=>{const o=(0,t.D7)().state.padding,d=2*(0,t.D7)().state.padding,g=e.node().getBBox(),u=g.width,a=g.x,s=e.append("text").attr("x",0).attr("y",(0,t.D7)().state.titleShift).attr("font-size",(0,t.D7)().state.fontSize).attr("class","state-title").text(i.id),p=s.node().getBBox().width+d;let c=Math.max(p,u);c===u&&(c=c+d);let h;const f=e.node().getBBox();i.doc,h=a-o,p>u&&(h=(u-c)/2+o),Math.abs(a-f.x)<o&&p>u&&(h=a-(p-u)/2);const E=1-(0,t.D7)().state.textHeight;return e.insert("rect",":first-child").attr("x",h).attr("y",E).attr("class",r?"alt-composit":"composit").attr("width",c).attr("height",f.height+(0,t.D7)().state.textHeight+(0,t.D7)().state.titleShift+1).attr("rx","0"),s.attr("x",h+o),p<=u&&s.attr("x",a+(c-d)/2-p/2+o),e.insert("rect",":first-child").attr("x",h).attr("y",(0,t.D7)().state.titleShift-(0,t.D7)().state.textHeight-(0,t.D7)().state.padding).attr("width",c).attr("height",(0,t.D7)().state.textHeight*3).attr("rx",(0,t.D7)().state.radius),e.insert("rect",":first-child").attr("x",h).attr("y",(0,t.D7)().state.titleShift-(0,t.D7)().state.textHeight-(0,t.D7)().state.padding).attr("width",c).attr("height",f.height+3+2*(0,t.D7)().state.textHeight).attr("rx",(0,t.D7)().state.radius),e},"addTitleAndBox"),F=(0,t.K2)(e=>(e.append("circle").attr("class","end-state-outer").attr("r",(0,t.D7)().state.sizeUnit+(0,t.D7)().state.miniPadding).attr("cx",(0,t.D7)().state.padding+(0,t.D7)().state.sizeUnit+(0,t.D7)().state.miniPadding).attr("cy",(0,t.D7)().state.padding+(0,t.D7)().state.sizeUnit+(0,t.D7)().state.miniPadding),e.append("circle").attr("class","end-state-inner").attr("r",(0,t.D7)().state.sizeUnit).attr("cx",(0,t.D7)().state.padding+(0,t.D7)().state.sizeUnit+2).attr("cy",(0,t.D7)().state.padding+(0,t.D7)().state.sizeUnit+2)),"drawEndState"),V=(0,t.K2)((e,i)=>{let r=(0,t.D7)().state.forkWidth,o=(0,t.D7)().state.forkHeight;if(i.parentId){let d=r;r=o,o=d}return e.append("rect").style("stroke","black").style("fill","black").attr("width",r).attr("height",o).attr("x",(0,t.D7)().state.padding).attr("y",(0,t.D7)().state.padding)},"drawForkJoinState"),X=(0,t.K2)((e,i,r,o)=>{let d=0;const g=o.append("text");g.style("text-anchor","start"),g.attr("class","noteText");let u=e.replace(/\r\n/g,"<br/>");u=u.replace(/\n/g,"<br/>");const a=u.split(t.Y2.lineBreakRegex);let s=1.25*(0,t.D7)().state.noteMargin;for(const x of a){const p=x.trim();if(p.length>0){const c=g.append("tspan");if(c.text(p),s===0){const h=c.node().getBBox();s+=h.height}d+=s,c.attr("x",i+(0,t.D7)().state.noteMargin),c.attr("y",r+d+1.25*(0,t.D7)().state.noteMargin)}}return{textWidth:g.node().getBBox().width,textHeight:d}},"_drawLongText"),Q=(0,t.K2)((e,i)=>{i.attr("class","state-note");const r=i.append("rect").attr("x",0).attr("y",(0,t.D7)().state.padding),o=i.append("g"),{textWidth:d,textHeight:g}=X(e,0,0,o);return r.attr("height",g+2*(0,t.D7)().state.noteMargin),r.attr("width",d+(0,t.D7)().state.noteMargin*2),r},"drawNote"),S=(0,t.K2)(function(e,i){const r=i.id,o={id:r,label:i.id,width:0,height:0},d=e.append("g").attr("id",r).attr("class","stateGroup");i.type==="start"&&z(d),i.type==="end"&&F(d),(i.type==="fork"||i.type==="join")&&V(d,i),i.type==="note"&&Q(i.note.text,d),i.type==="divider"&&G(d),i.type==="default"&&i.descriptions.length===0&&J(d,i),i.type==="default"&&i.descriptions.length>0&&Y(d,i);const g=d.node().getBBox();return o.width=g.width+2*(0,t.D7)().state.padding,o.height=g.height+2*(0,t.D7)().state.padding,W.set(r,o),o},"drawState"),O=0,$=(0,t.K2)(function(e,i,r){const o=(0,t.K2)(function(s){switch(s){case M.u4.relationType.AGGREGATION:return"aggregation";case M.u4.relationType.EXTENSION:return"extension";case M.u4.relationType.COMPOSITION:return"composition";case M.u4.relationType.DEPENDENCY:return"dependency"}},"getRelationType");i.points=i.points.filter(s=>!Number.isNaN(s.y));const d=i.points,g=(0,K.n8j)().x(function(s){return s.x}).y(function(s){return s.y}).curve(K.qrM),u=e.append("path").attr("d",g(d)).attr("id","edge"+O).attr("class","transition");let a="";if((0,t.D7)().state.arrowMarkerAbsolute&&(a=window.location.protocol+"//"+window.location.host+window.location.pathname+window.location.search,a=a.replace(/\(/g,"\\("),a=a.replace(/\)/g,"\\)")),u.attr("marker-end","url("+a+"#"+o(M.u4.relationType.DEPENDENCY)+"End)"),r.title!==void 0){const s=e.append("g").attr("class","stateLabel"),{x,y:p}=j._K.calcLabelPosition(i.points),c=t.Y2.getRows(r.title);let h=0;const f=[];let E=0,w=0;for(let n=0;n<=c.length;n++){const m=s.append("text").attr("text-anchor","middle").text(c[n]).attr("x",x).attr("y",p+h),l=m.node().getBBox();E=Math.max(E,l.width),w=Math.min(w,l.x),t.Rm.info(l.x,x,p+h),h===0&&(h=m.node().getBBox().height,t.Rm.info("Title height",h,p)),f.push(m)}let k=h*c.length;if(c.length>1){const n=(c.length-1)*h*.5;f.forEach((m,l)=>m.attr("y",p+l*h-n)),k=h*c.length}const v=s.node().getBBox();s.insert("rect",":first-child").attr("class","box").attr("x",x-E/2-(0,t.D7)().state.padding/2).attr("y",p-k/2-(0,t.D7)().state.padding/2-3.5).attr("width",E+(0,t.D7)().state.padding).attr("height",k+(0,t.D7)().state.padding),t.Rm.info(v)}O++},"drawEdge"),_,b={},q=(0,t.K2)(function(){},"setConf"),tt=(0,t.K2)(function(e){e.append("defs").append("marker").attr("id","dependencyEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 19,7 L9,13 L14,7 L9,1 Z")},"insertMarkers"),et=(0,t.K2)(function(e,i,r,o){_=(0,t.D7)().state;const d=(0,t.D7)().securityLevel;let g;d==="sandbox"&&(g=(0,K.Ltv)("#i"+i));const u=d==="sandbox"?(0,K.Ltv)(g.nodes()[0].contentDocument.body):(0,K.Ltv)("body"),a=d==="sandbox"?g.nodes()[0].contentDocument:document;t.Rm.debug("Rendering diagram "+e);const s=u.select(`[id='${i}']`);tt(s);const x=o.db.getRootDoc();N(x,s,void 0,!1,u,a,o);const p=_.padding,c=s.node().getBBox(),h=c.width+p*2,f=c.height+p*2,E=h*1.75;(0,t.a$)(s,f,E,_.useMaxWidth),s.attr("viewBox",`${c.x-_.padding}  ${c.y-_.padding} `+h+" "+f)},"draw"),at=(0,t.K2)(e=>e?e.length*_.fontSizeFactor:1,"getLabelWidth"),N=(0,t.K2)((e,i,r,o,d,g,u)=>{const a=new A.T({compound:!0,multigraph:!0});let s,x=!0;for(s=0;s<e.length;s++)if(e[s].stmt==="relation"){x=!1;break}r?a.setGraph({rankdir:"LR",multigraph:!0,compound:!0,ranker:"tight-tree",ranksep:x?1:_.edgeLengthFactor,nodeSep:x?1:50,isMultiGraph:!0}):a.setGraph({rankdir:"TB",multigraph:!0,compound:!0,ranksep:x?1:_.edgeLengthFactor,nodeSep:x?1:50,ranker:"tight-tree",isMultiGraph:!0}),a.setDefaultEdgeLabel(function(){return{}});const p=u.db.getStates(),c=u.db.getRelations(),h=Object.keys(p);let f=!0;for(const n of h){const m=p[n];r&&(m.parentId=r);let l;if(m.doc){let y=i.append("g").attr("id",m.id).attr("class","stateGroup");if(l=N(m.doc,y,m.id,!o,d,g,u),f){y=Z(y,m,o);let B=y.node().getBBox();l.width=B.width,l.height=B.height+_.padding/2,b[m.id]={y:_.compositTitleSize}}else{let B=y.node().getBBox();l.width=B.width,l.height=B.height}}else l=S(i,m,a);if(m.note){const y={descriptions:[],id:m.id+"-note",note:m.note,type:"note"},B=S(i,y,a);m.note.position==="left of"?(a.setNode(l.id+"-note",B),a.setNode(l.id,l)):(a.setNode(l.id,l),a.setNode(l.id+"-note",B)),a.setParent(l.id,l.id+"-group"),a.setParent(l.id+"-note",l.id+"-group")}else a.setNode(l.id,l)}t.Rm.debug("Count=",a.nodeCount(),a);let E=0;c.forEach(function(n){E++,t.Rm.debug("Setting edge",n),a.setEdge(n.id1,n.id2,{relation:n,width:at(n.title),height:_.labelHeight*t.Y2.getRows(n.title).length,labelpos:"c"},"id"+E)}),(0,U.Zp)(a),t.Rm.debug("Graph after layout",a.nodes());const w=i.node();a.nodes().forEach(function(n){n!==void 0&&a.node(n)!==void 0?(t.Rm.warn("Node "+n+": "+JSON.stringify(a.node(n))),d.select("#"+w.id+" #"+n).attr("transform","translate("+(a.node(n).x-a.node(n).width/2)+","+(a.node(n).y+(b[n]?b[n].y:0)-a.node(n).height/2)+" )"),d.select("#"+w.id+" #"+n).attr("data-x-shift",a.node(n).x-a.node(n).width/2),g.querySelectorAll("#"+w.id+" #"+n+" .divider").forEach(l=>{const y=l.parentElement;let B=0,T=0;y&&(y.parentElement&&(B=y.parentElement.getBBox().width),T=parseInt(y.getAttribute("data-x-shift"),10),Number.isNaN(T)&&(T=0)),l.setAttribute("x1",0-T+8),l.setAttribute("x2",B-T-8)})):t.Rm.debug("No Node "+n+": "+JSON.stringify(a.node(n)))});let k=w.getBBox();a.edges().forEach(function(n){n!==void 0&&a.edge(n)!==void 0&&(t.Rm.debug("Edge "+n.v+" -> "+n.w+": "+JSON.stringify(a.edge(n))),$(i,a.edge(n),a.edge(n).relation))}),k=w.getBBox();const v={id:r||"root",label:r||"root",width:0,height:0};return v.width=k.width+2*_.padding,v.height=k.height+2*_.padding,t.Rm.debug("Doc rendered",v,a),v},"renderDoc"),it={setConf:q,draw:et},nt={parser:M.Zk,get db(){return new M.u4(1)},renderer:it,styles:M.tM,init:(0,t.K2)(e=>{e.state||(e.state={}),e.state.arrowMarkerAbsolute=e.arrowMarkerAbsolute},"init")}}}]);
